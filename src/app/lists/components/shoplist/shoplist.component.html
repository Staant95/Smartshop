<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button></ion-back-button>
        </ion-buttons>

        <ion-title>{{listName}}</ion-title>

        <!--
        <ion-item slot="end" lines="none">
            <ion-icon name="add" color="primary"></ion-icon>
        </ion-item>
        -->


    </ion-toolbar>
</ion-header>



<ion-content>

<ion-list>
    <ion-item-sliding *ngFor="let product of products$ | async; let i = index">


        <ion-item>
            <ion-avatar slot="start">
                <img src="{{product.avatar}}">
            </ion-avatar>
            <ion-text class="ion-padding">
                <div>{{product.name}}</div>
                <div style="color: var(--ion-color-secondary); font-size:0.9em;">{{product.brand}}</div>
                <div style="color: var(--ion-color-secondary); font-size:0.9em;">{{product.format}}</div>
            </ion-text>

            <div slot="end">
                <div class="ion-text-center" style="max-height:1em;">
                    <ion-icon name="chevron-up-outline" style="font-size:1em; color:#888;" (click)="increaseQuantity(product)"></ion-icon>
                </div>
                <div>
                    <label #quantity class="ion-text-center" style=" font-size:1.8em; color: var(--ion-color-primary);" >{{product.quantity}}</label>
                </div>
                <div class="ion-text-center" style="max-height:1em; font-size:1em;">
                    <ion-icon name="chevron-down-outline" style="font-size:1em; color:#888;" (click)="decreaseQuantity(product)"></ion-icon>
                </div>
            </div>
        </ion-item>

        <ion-item-options side="end" (click)="deleteProduct(product.id)">
            <ion-item-option>
                <ion-icon slot="icon-only" name="trash"></ion-icon>
            </ion-item-option>
        </ion-item-options>
    </ion-item-sliding>

</ion-list>


    <!-- fab placed to the top end -->

        <ion-fab vertical="bottom" horizontal="end" slot="fixed">
            <ion-fab-button routerLink="search">
                <ion-icon name="search"></ion-icon>
            </ion-fab-button>
        </ion-fab>



</ion-content>

<ion-footer *ngIf="(products$ | async).length">
    <div *ngIf="(compareSupermarketsBtn$ | async); else showSupermarket">
        <ion-item lines="none"  >
            <ion-label style="font-size:0.8em;" class="ion-text-center " color="tertiary">Distanza supermercato</ion-label>
        </ion-item>


        <ion-item lines="none" >
            <ion-range #rangeBar min="0" max="20" pin snaps="true" step="2" color="secondary" class="ion-no-padding">
                <ion-icon slot="start" name="man"></ion-icon>
                <ion-icon slot="end" name="cart"></ion-icon>
            </ion-range>
        </ion-item>

        <div style="display:flex; padding-bottom:1em; width:100%; align-items: center; justify-content: center; border: 1px solid transparent;">
            <ion-button (click)="compareSupermarket(rangeBar.value)">Confronta supermercati</ion-button>
        </div>
    </div>

</ion-footer>


<ng-template #showSupermarket>

    <div *ngIf="bestSupermarket$| async as supermarket">
        <ion-item>
            <ion-avatar class="item-avatar" slot="start">
                <img src="https://external-content.duckduckgo.com/iu/?u=http%3A%2F%2Fimages.gofreedownload.net%2Fconad-117103.jpg&f=1&nofb=1">
            </ion-avatar>
            <ion-text class="ion-padding">
                <div  class="ion-margin">{{supermarket.name}}</div>
                <div style="color: var(--ion-color-secondary); font-size:1em;" class="ion-margin"> <ion-icon name="location-outline" style="color: var(--ion-color-tertiary);" class="ion-margin-end"></ion-icon> {{supermarket.city}} - {{supermarket.location}}</div>
                <div style="color: var(--ion-color-secondary); font-size:1em;" class="ion-margin"> <ion-icon name="wallet-outline"  style="color: var(--ion-color-tertiary);" class="ion-margin-end"></ion-icon> {{supermarket.total}} â‚¬</div>
            </ion-text>
        </ion-item>

    </div>
</ng-template>